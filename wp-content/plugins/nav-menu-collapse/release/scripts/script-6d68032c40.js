/*! Primary plugin JavaScript. * @since 1.0.0 * @package Nav Menu Collapse */
var nmc_script_options=nmc_script_options||{},wp=window.wp||{},wpNavMenu=wpNavMenu||{},nmc_dragged_item=null,nmc_dropped_item=null,nmc_hovered_item=null,ajaxurl=ajaxurl||"",pagenow=pagenow||"",postboxes=postboxes||{};!function(i){"use strict";i.fn.extend({nmc_add_event:function(e,n){return this.addClass(e).on(e,n).nmc_trigger_all(e)},nmc_trigger_all:function(e,n){return n="undefined"===i.type(n)?[]:n,n=i.isArray(n)?n:[n],this.each(function(){i(this).triggerHandler(e,n)})},nmc_unprepared:function(e){var n="nmc-prepared";return n+=e?"-"+e:"",this.not("."+n).addClass(n)}}),i.nmc=i.nmc||{},i.extend(i.nmc,{body:i(document.body),document:i(document),options:nmc_script_options,window:i(window),scroll_element:i("html,body").on("DOMMouseScroll keyup mousedown mousewheel scroll touchmove wheel",function(){i(this).stop()})}),i.nmc.data=i.nmc.data||{},i.extend(i.nmc.data,{help_tab_id:"nmc-help-tab-id"}),i.nmc.events=i.nmc.events||{},i.extend(i.nmc.events,{setup:"nmc-setup"}),i.nmc.global=i.nmc.global||{},i.extend(i.nmc.global,{help_buttons:function(e){(void 0===e?i("#contextual-help-wrap .nmc-help-button[data-"+i.nmc.data.help_tab_id+"],.wrap .nmc-help-button[data-"+i.nmc.data.help_tab_id+"]").not(".nmc-disabled"):e.find(".nmc-help-button")).nmc_unprepared().css({display:"inline-block",opacity:"1"}).click(function(e){e.stopPropagation(),i.nmc.scroll_element.animate({scrollTop:"0px"},{queue:!1});function n(){i("#tab-link-"+t.data(i.nmc.data.help_tab_id)+" > a").click(),i("#contextual-help-link").not(".screen-meta-active").click()}var t=i(this),a=i("#show-settings-link");a.hasClass("screen-meta-active")?(a.click(),setTimeout(n,250)):n()}),i("#screen-options-wrap .nmc-help-button").remove()},help_tabs:function(){var e=i("#contextual-help-columns");e.find('li[id^="tab-link-nmc-"],.help-tab-content[id^="tab-panel-nmc-"]').each(function(){var e=i(this);e.appendTo(e.parent())}),e.find(".contextual-help-tabs > ul,.contextual-help-tabs-wrap").each(function(){i(this).children().removeClass("active").first().addClass("active")})}}),i.nmc.document.ready(function(){i.nmc.global.help_buttons(),i.nmc.global.help_tabs()}),i.nmc.options.is_settings?(i.extend(i.nmc.data,{compare:"nmc-compare",conditional:"nmc-conditional",field:"nmc-field",value:"nmc-value"}),i.extend(i.nmc.events,{check_conditions:"nmc-check-conditions"}),i.nmc.settings=i.nmc.settings||{},i.extend(i.nmc.settings,{conditional_logic:function(){i(".nmc-condition[data-"+i.nmc.data.conditional+"][data-"+i.nmc.data.field+"][data-"+i.nmc.data.value+"][data-"+i.nmc.data.compare+"]").each(function(){var e=i(this),n=i('[name="'+e.data(i.nmc.data.conditional)+'"]'),t=i('[name="'+e.data(i.nmc.data.field)+'"]');n.hasClass(i.nmc.events.check_conditions)||n.nmc_add_event(i.nmc.events.check_conditions,function(){var e=i(this),l=!0;i(".nmc-condition[data-"+i.nmc.data.conditional+'="'+e.attr("name")+'"][data-'+i.nmc.data.field+"][data-"+i.nmc.data.value+"][data-"+i.nmc.data.compare+"]").each(function(){var e=i(this),n=i('[name="'+e.data(i.nmc.data.field)+'"]'),t=n.is(":radio")?n.filter(":checked").val():n.val(),a=e.data(i.nmc.data.compare),c=!1;n.is(":checkbox")&&(t=n.is(":checked")?t:""),c="!="===a?e.data(i.nmc.data.value)+""!=t+"":e.data(i.nmc.data.value)+""==t+"",l=l&&c});var n=e.closest(".nmc-field");n.next(".nmc-field-spacer").remove(),l?n.stop(!0).slideDown(125):n.stop(!0).slideUp(125).after(i("<div/>").addClass("nmc-hidden nmc-field-spacer"))}),t.hasClass("nmc-has-condition")||t.addClass("nmc-has-condition").on("change",function(){i(".nmc-condition[data-"+i.nmc.data.conditional+"][data-"+i.nmc.data.field+'="'+i(this).attr("name")+'"][data-'+i.nmc.data.value+"][data-"+i.nmc.data.compare+"]").each(function(){i('[name="'+i(this).data(i.nmc.data.conditional)+'"]').nmc_trigger_all(i.nmc.events.check_conditions)})})})},form:function(){i("#nav_menu_collapse_settings form").submit(function(){i(this).find('[type="submit"]').prop("disabled",!0)}).find('[type="submit"]').prop("disabled",!1)},postboxes:function(){i(".if-js-closed").removeClass("if-js-closed").addClass("closed"),void 0!==postboxes&&void 0!==pagenow&&postboxes.add_postbox_toggles(pagenow)}}),i.nmc.document.ready(function(){i.nmc.settings.conditional_logic(),i.nmc.settings.form(),i.nmc.settings.postboxes()})):i.nmc.options.is_nav_menus&&(i.fn.extend({nmc_direct_child_menu_items:function(){var l=i();return this.each(function(){for(var e=i(this),n=e.menuItemDepth(),t=e.next(".menu-item"),a=0===t.length?n:t.menuItemDepth(),c=a;0<t.length&&n<c;)t.hasClass("deleting")?l=l.add(t.nmc_direct_child_menu_items()):c===a&&(l=l.add(t)),c=0===(t=t.next(".menu-item")).length?n:t.menuItemDepth()}),l}}),i.nmc.callbacks=i.nmc.callbacks||{},i.extend(i.nmc.callbacks,{stored:[],add:function(e){"function"==typeof e&&(i.nmc.callbacks.stored[i.nmc.callbacks.stored.length]=e)},fire:function(){0<i.nmc.callbacks.stored.length&&i.nmc.callbacks.stored.shift()()}}),i.extend(i.nmc.data,{timeout:"nmc-timeout"}),i.extend(i.nmc.events,{extend:"nmc-extend"}),i.nmc.nav_menus=i.nmc.nav_menus||{},i.extend(i.nmc.nav_menus,{override_nav_menus:function(){i.fn.default_shiftDepthClass=i.fn.shiftDepthClass,i.fn.shiftDepthClass=function(e){return this.default_shiftDepthClass(e),this.each(function(){var e=i(this);0===e.menuItemDepth()&&e.find(".is-submenu").hide()})},wpNavMenu.menuList.on("sortstart",function(e,n){nmc_dragged_item=n.item,i.nmc.window.mousemove(i.nmc.nav_menus.mousemove)}).on("sortstop",function(e,n){i.nmc.window.unbind("mousemove",i.nmc.nav_menus.mousemove),i.nmc.nav_menus.clear_hovered(),nmc_dragged_item=null,nmc_dropped_item=n.item}),i.extend(wpNavMenu,{default_addItemToMenu:wpNavMenu.addItemToMenu,default_eventOnClickMenuItemDelete:wpNavMenu.eventOnClickMenuItemDelete,default_registerChange:wpNavMenu.registerChange,default_eventOnClickMenuSave:wpNavMenu.eventOnClickMenuSave}),i.extend(wpNavMenu,{addItemToMenu:function(e,n,t){i(".menu-item.pending:hidden").addClass("nmc-hidden"),i.nmc.callbacks.add(t),t=function(){i(".menu-item.nmc-hidden").stop(!0,!0).hide().removeClass("nmc-hidden"),i.nmc.callbacks.fire(),i.nmc.nav_menus.collapse_expand()},wpNavMenu.default_addItemToMenu(e,n,t)},eventOnClickMenuItemDelete:function(e){var n=i(e).closest(".menu-item");return n.is(".nmc-collapsed")&&n.find(".nmc-collapse-expand").nmc_trigger_all("click"),i.nmc.nav_menus.check_all_buttons(),wpNavMenu.default_eventOnClickMenuItemDelete(e),!1},registerChange:function(){if(wpNavMenu.default_registerChange(),i.nmc.nav_menus.check_collapsibility(),null!==nmc_dropped_item){for(var e=nmc_dropped_item.menuItemDepth();0<e;){e-=1;var n=nmc_dropped_item.prevAll(".menu-item-depth-"+e).first();n.hasClass("nmc-collapsed")&&n.find(".nmc-collapse-expand").triggerHandler("click")}nmc_dropped_item=null}i.nmc.nav_menus.check_all_buttons()},eventOnClickMenuSave:function(e){if("1"!==i.nmc.options.collapsed&&!i.nmc.body.hasClass("nmc-ajax")){i.nmc.body.addClass("nmc-ajax");var n=[];i(".menu-item.nmc-collapsed").each(function(){n.push(i(this).find("input.menu-item-data-db-id").val())}),i.post({url:ajaxurl,async:!1,dataType:"json",data:{action:"nmc_collapsed",menu_id:i("#menu").val(),collapsed:n},complete:function(){i.nmc.body.removeClass("nmc-ajax")}})}return wpNavMenu.default_eventOnClickMenuSave(e)}})},collapse_expand_all:function(){var e=i(wp.template("nmc-collapse-expand-all")());e&&(e.insertBefore(i("#menu-to-edit")).find(".nmc-collapse-all").click(function(){i(this).prop("disabled",!0).siblings().prop("disabled",!1),i(".nmc-collapsible").not(".nmc-collapsed").find(".nmc-collapse-expand").nmc_trigger_all("click",[!0])}),e.find(".nmc-expand-all").click(function(){i(this).prop("disabled",!0).siblings().prop("disabled",!1),i(".nmc-collapsed").find(".nmc-collapse-expand").nmc_trigger_all("click",[!0])}),i.nmc.global.help_buttons())},collapse_expand:function(){var e=i(wp.template("nmc-collapse-expand")()).click(function(e,n){function t(){i(this).css("height","")}var a=i(this).closest(".menu-item");if(a.hasClass("nmc-collapsed")){a.removeClass("nmc-collapsed");for(var c=a.nmc_direct_child_menu_items();0<c.length;)c.stop(!0).slideDown(125,t),c=c.filter(".nmc-collapsible").not(".nmc-collapsed").nmc_direct_child_menu_items()}else a.addClass("nmc-collapsed"),a.childMenuItems().stop(!0).slideUp(125,t);!0!==n&&i.nmc.nav_menus.check_all_buttons()});i("#menu-to-edit").children().not(".nmc-active").addClass("nmc-active").each(function(){e.clone(!0).appendTo(i(this).find(".item-controls"))}).on(i.nmc.events.extend,function(){var e=i(this),n=null===nmc_hovered_item;!n&&nmc_hovered_item.is(e)||(n||i.nmc.nav_menus.clear_hovered(),(nmc_hovered_item=e).data(i.nmc.data.timeout,setTimeout(function(){nmc_hovered_item.find(".nmc-collapse-expand").triggerHandler("click"),i.nmc.nav_menus.clear_hovered()},1e3)))}),i.nmc.nav_menus.check_collapsibility()},set_collapsed:function(){if(i.isPlainObject(i.nmc.options.collapsed)){var e=i("#menu").val();e in i.nmc.options.collapsed&&i.each(i.nmc.options.collapsed[e],function(e,n){i("input.menu-item-data-db-id[value="+n+"]").closest(".menu-item").find(".nmc-collapse-expand").triggerHandler("click")})}else i("#nmc-collapse-expand-all .nmc-collapse-all").triggerHandler("click")},check_all_buttons:function(){i("#nmc-collapse-expand-all .nmc-collapse-all").prop("disabled",0===i("#menu-to-edit > .menu-item.nmc-collapsible").not(".deleting").not(".nmc-collapsed").length),i("#nmc-collapse-expand-all .nmc-expand-all").prop("disabled",0===i("#menu-to-edit > .menu-item.nmc-collapsible.nmc-collapsed").not(".deleting").length)},check_collapsibility:function(){var c=!1;i("#menu-to-edit > .menu-item").each(function(){var e=i(this);e.hasClass("deleting")||0===e.nmc_direct_child_menu_items().length?e.removeClass("nmc-collapsible nmc-collapsed"):(c=!0,e.addClass("nmc-collapsible"));var n=e.childMenuItems().length,t=e.find(".menu-item-title"),a=t.next(".nmc-counter").hide().removeAttr("title").empty();0<n&&(a=0===a.length?i("<abbr/>").addClass("nmc-counter").insertAfter(t):a).attr("title",i.nmc.options.nested.replace("%d",n)).html("("+n+")").show()});var e=i("#nmc-collapse-expand-all").stop(!0),n=e.is(":visible");c&&!n?e.slideDown(125,function(){i(this).css("height","")}):!c&&n&&e.slideUp(125,function(){i(this).css("height","")})},clear_hovered:function(){null!==nmc_hovered_item&&(clearTimeout(nmc_hovered_item.data(i.nmc.data.timeout)),nmc_hovered_item=null)},mousemove:function(){var t=nmc_dragged_item.position();t.right=t.left+nmc_dragged_item.width(),t.bottom=t.top+nmc_dragged_item.height();var e=wpNavMenu.menuList.children(".menu-item.nmc-collapsed:visible").not(nmc_dragged_item).filter(function(){var e=i(this),n=e.position();return n.top<=t.bottom&&n.top+e.height()>=t.top&&n.left<=t.right&&n.left+e.width()>=t.left}).first();0===e.length?i.nmc.nav_menus.clear_hovered():e.is(nmc_hovered_item)||e.triggerHandler(i.nmc.events.extend)}}),i.nmc.document.ready(function(){i.nmc.nav_menus.override_nav_menus(),i.nmc.nav_menus.collapse_expand_all(),i.nmc.nav_menus.collapse_expand(),i.nmc.nav_menus.set_collapsed()}))}(jQuery);